{% load humanize %}


<script type="text/javascript">

  // Import Vue2Leaflet components. 
  const GEO_JSON = JSON.parse('{{ GEO_JSON|escapejs }}');
  const item_json = JSON.parse('{{ item_json|escapejs }}');
  const ITEM_UUID = item_json.uuid;
  const l_popup = Vue.component('l-popup', window.Vue2Leaflet.LPopup);
  const l_tile_layer = Vue.component(
    'l-tile-layer', 
    window.Vue2Leaflet.LTileLayer,
  );
  const l_img_overlay = Vue.component(
    'l-img-overlay', 
    window.Vue2Leaflet.LImageOverlay,
  );
  const l_geo_json = Vue.component(
    'l-geo-json', 
    window.Vue2Leaflet.LGeoJson,
  );
  const l_control_layers = Vue.component(
    'l-control-layers', 
    window.Vue2Leaflet.LControlLayers,
  );
  const l_marker = Vue.component(
    'l-marker', 
    window.Vue2Leaflet.LMarker,
  );
  const l_map = Vue.component(
    'l-map', 
    window.Vue2Leaflet.LMap,
  );

  const MAX_ZOOM_TILES = 26;
  const MAX_ZOOM = 30;
  
  const GOOGLE_API_KEY = 'AIzaSyAuhr3tCQOxbGxnOki11vuvDB86-sxjHwo';
  const MAPBOX_PUBLIC_ACCESS_TOKEN = '{{ MAPBOX_PUBLIC_ACCESS_TOKEN|escapejs }}';
  
  var GOOGLE_ROAD = L.gridLayer.googleMutant({
      maxZoom: MAX_ZOOM_TILES,
      name: "Google Road",
      type: "roadmap",
      attribution: 'Map data: © <a target="_blank" href="https://google.com">Google.com</a>',
    });

  var GOOGLE_SAT = L.gridLayer.googleMutant({
    maxZoom: MAX_ZOOM_TILES,
    name: "Google Aerial",
    type: "satellite",
    attribution: 'Map data: © <a target="_blank" href="https://google.com">Google.com</a>',
  });

  var GOOGLE_TERRAIN = L.gridLayer.googleMutant({
    maxZoom: MAX_ZOOM_TILES,
    name: "Google Terrain",
    type: "terrain",
    attribution: 'Map data: © <a target="_blank" href="https://google.com">Google.com</a>',
  });

  var GOOGLE_HYBRID = L.gridLayer.googleMutant({
    maxZoom: MAX_ZOOM_TILES,
    name: "Google Hybrid",
    type: "hybrid",
    attribution: 'Map data: © <a target="_blank" href="https://google.com">Google.com</a>',
  });

  var GOOGLE_TILES = [
    GOOGLE_SAT,
    GOOGLE_TERRAIN,
    GOOGLE_ROAD,
    GOOGLE_HYBRID,
  ];


  const TILE_PROVIDERS = [
    {
      name: 'MapBox Satellite',
      visible: true,
      id: 'mapbox-satellite',
      url: (
        'https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/{z}/{x}/{y}?access_token='
        + MAPBOX_PUBLIC_ACCESS_TOKEN
      ),
      attribution: 'Map data: © <a target="_blank" href="https://MapBox.com">MapBox.com</a>',
      maxZoom: MAX_ZOOM,
      maxNativeZoom: MAX_ZOOM_TILES,
    },
    {
      name: 'OpenStreetMap',
      visible: false,
      id: 'osm',
      url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      attribution: '© <a target="_blank" href="http://osm.org/copyright">OpenStreetMap</a> contributors',
      maxZoom: MAX_ZOOM,
      maxNativeZoom: MAX_ZOOM_TILES,
    },
    {
      name: 'OpenTopoMap',
      visible: false,
      id: 'otm',
      url: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
      attribution: 'Map data: © <a target="_blank" href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: © <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',
      maxZoom: MAX_ZOOM,
      maxNativeZoom: MAX_ZOOM_TILES,
    },
    {
      name: 'MapBox Light',
      visible: false,
      id: 'mapbox-light',
      url: (
        'https://api.mapbox.com/styles/v1/mapbox/light-v10/tiles/{z}/{x}/{y}?access_token=' 
        + MAPBOX_PUBLIC_ACCESS_TOKEN
      ),
      attribution: 'Map data: © <a target="_blank" href="https://MapBox.com">MapBox.com</a>',
      maxZoom: MAX_ZOOM,
      maxNativeZoom: MAX_ZOOM_TILES,
    },
    {
      name: 'MapBox Dark',
      visible: false,
      id: 'mapbox-dark',
      url: (
        'https://api.mapbox.com/styles/v1/mapbox/dark-v10/tiles/{z}/{x}/{y}?access_token='
        + MAPBOX_PUBLIC_ACCESS_TOKEN
      ),
      attribution: 'Map data: © <a href="https://MapBox.com">MapBox.com</a>',
      maxZoom: MAX_ZOOM,
      maxNativeZoom: MAX_ZOOM_TILES,
    },
  ];

const router = new VueRouter({
  mode: 'history',
  linkExactActiveClass: 'active',
  routes: [],
});

function add_links(str){
  if (!(typeof str === 'string' || str instanceof String)){
    return str;
  }
  if(str.startsWith("https://")||str.startsWith("http://")){
    return `<a target="_blank" href="${str}">${str}</a>`;
  }
  return str;
}

</script>

