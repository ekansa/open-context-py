{% extends '../page.html' %}

{% block content %}


{% include '../item/parts/vue_shared.html' %}
{% include '../item/parts/vue_images_human_remains.html' %}
{% include '../color_gradients.html' %}

{% if GEO_JSON %}
{% include '../common_geo.html' %}
{%endif%}

{% if man_obj.item_type == 'predicates' %}

    {% include '../item/parts/predicates_vc.html' %}

{%endif%}

{% if man_obj.item_type == 'projects' %}

    {% include '../item/parts/projects_vc.html' %}

{%endif%}

{% if man_obj.item_type == 'types' %}

    {% include '../item/parts/types_examples.html' %}

{%endif%}



<div id="project_hero_banner">
    {% if man_obj.hero %}
        <img class="img-fluid mx-auto d-block" 
             alt="project banner image" 
             src="https://{{ man_obj.hero }}" />
    {% elif man_obj.proj_hero %}
        <img class="img-fluid mx-auto d-block" 
            alt="project banner image" 
            src="https://{{ man_obj.proj_hero }}" />
    {% elif man_obj.proj_proj_hero %}
        <img class="img-fluid mx-auto d-block" 
            alt="project banner image" 
            src="https://{{ man_obj.proj_proj_hero }}" />
    {% else %}
        <img class="img-fluid mx-auto d-block" 
            alt="default project banner image" 
            src="https://opencontext.org/static/oc/images/projects/project-default-hero.png" />
    {%endif%}
</div>


<!-- General template for views of Open Context items -->
<div id="main">

    <div id="item-app" class="container-fluid">

        {% include '../item/parts/contexts.html' %}

        {% if full_media %}
        
            {% include '../item/parts/preview_iiif.html' %}
            {% include '../item/parts/preview_nexus.html' %}
            {% include '../item/parts/preview_x3dom.html' %}
            {% include '../item/parts/preview_pdf.html' %}
            {% include '../item/parts/preview_geojson.html' %}

        {%endif%}
        
        <div class="row">
            <div class="col-lg-8 col-md-12">

        {% if not full_media %}

            {% include '../item/parts/preview_image.html' %}
            {% include '../item/parts/preview_nexus.html' %}
            {% include '../item/parts/preview_x3dom.html' %}
            {% include '../item/parts/preview_pdf.html' %}
            {% include '../item/parts/preview_geojson.html' %}

        {%endif%}



        {% if man_obj.item_type == 'predicates' %}
            <!-- Note: Some templated not in javascript to ease search engine bot indexing.-->
            <div class="card">
                <div class="card-header">
                {% if man_obj.item_class.slug == 'oc-gen-variables' %}
                <h5><b>{{ man_obj.label }}</b> (Descriptive Attribute)</h5>
                {%else%}
                <h5><b>{{ man_obj.label }}</b> (Linking Relation)</h5>
                {%endif%}
                </div>
                <div class="card-body">
                    <vc-predicates
                        :base_search_url="'/query'"
                        v-bind:predicate_label="'{{ man_obj.label|safe }}'"
                        v-bind:predicate_slug="'{{ man_obj.slug|safe }}'"
                        v-bind:predicate_class_slug="'{{ man_obj.item_class.slug|safe }}'"
                        v-bind:data_type="'{{ man_obj.data_type|safe }}'"
                    ></vc-predicates>
                </div>
            </div>
        {%endif%}

        {% if man_obj.item_type == 'types' %}
        <!-- Note: Some templated not in javascript to ease search engine bot indexing.-->
        <div class="card">
            <div class="card-header">
                <h5><b>{{ man_obj.label }}</b> (Classification Category or Type)</h5>
            </div>
            <div class="card-body">
                <types-examples
                    :base_search_url="'/query'"
                    v-bind:predicate_label="'{{ man_obj.context.label|safe }}'"
                    v-bind:predicate_slug="'{{ man_obj.context.slug|safe }}'"
                    v-bind:type_label="'{{ man_obj.label|safe }}'"
                    v-bind:type_slug="'{{ man_obj.slug|safe }}'"
                ></types-examples>
            </div>
        </div>
        {%endif%}


            {% include '../item/parts/content_text.html' %}
            {% include '../item/parts/observations.html' %}

            </div>

            <div class="col-lg-4 col-md-12">

                <human-remains-results-alert
                    v-bind:human_remains_flagged="human_remains_flagged"
                    v-bind:human_remains_ok="human_remains_ok"
                    :alert_type="'item'"
                    @toggle_human_remains_ok="toggle_human_remains_ok($event)"
                ></human-remains-results-alert>

                {% include '../item/parts/media_download.html' %}

                {% if man_obj.item_type == 'projects' %}

                    <vc-projects
                        :base_search_url="'/query'"
                        v-bind:project_label="'{{ man_obj.label|safe }}'"
                        v-bind:project_slug="'{{ man_obj.slug|safe }}'"
                    ></vc-projects>

                {%endif%}

                {% include '../item/parts/citation.html' %}

                {% include '../item/parts/project_context.html' %}

                {% include '../item/parts/spacetime.html' %}

                {% include '../item/parts/license.html' %}
            </div>
        </div>

        {% if show_json %}
        <div class="row">
            <div class="col">
                <label for="item_json" class="form-label">Item JSON</label>
                <textarea class="form-control form-control-sm" id="item_json" rows="25">{{ item_json|safe }}
                </textarea>
            </div>
        </div>
        {%endif%}

    </div>

</div>

<script type="text/javascript">

  // Import Vue2Leaflet components. 
  {% if GEO_JSON %}
  const GEO_JSON = JSON.parse('{{ GEO_JSON|escapejs }}');
  {% else %}
  let GEO_JSON = null;
  {% endif %}

  {% if item.media_preview_geojson %}
  const GEO_JSON_URL = "{{ item.media_preview_geojson }}";
  {% else %}
  const GEO_JSON_URL = null;
  {% endif %}


  const USE_TEST_ALL_ITEMS_HREF = true;

  const item_json = JSON.parse('{{ item_json|escapejs }}');
  const ITEM_UUID = item_json.uuid;

  {% if item.flag_human_remains %}
  // Initial state from the request session token.
  const HUMAN_REMAINS_FLAGGED = true;
  
  {% else %}

  const HUMAN_REMAINS_FLAGGED = false;

  {% endif %}

  {% if item.media_iiif %}
  const MEDIA_IIIF_INFO = "{{ item.media_iiif }}";
  {% else %}
  const MEDIA_IIIF_INFO = null;
  {% endif %}

  {% if full_media %}
  const SHOW_FULL_MEDIA = true;
  {% else %}
  const SHOW_FULL_MEDIA = false;
  {% endif %}
 
    
    var vm = new Vue(
      {
        delimiters: ['[[', ']]'],
        ref: 'item_app',
        el: '#item-app',
        data: {
            uuid: ITEM_UUID,
            human_remains_flagged: HUMAN_REMAINS_FLAGGED,
            human_remains_ok: HUMAN_REMAINS_OK,
            media_iiif_info: MEDIA_IIIF_INFO,
            show_full_media: SHOW_FULL_MEDIA,
            osd: null,
        },
        computed: {
            
        },
        methods: {
            toggle_human_remains_ok: function(human_remains_ok) {
                this.human_remains_ok = human_remains_ok;
            },
        },
        created() {
    
        },
        mounted() {
            this.start_iiif_viewer();
        },
        methods: {
            start_iiif_viewer: function(){
                if(!this.media_iiif_info||!this.show_full_media){
                    return null;
                }
                if(this.osd){
                    return null;
                }
                this.osd = OpenSeadragon({
                    id:            "iiif-zone",
                    prefixUrl:     "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.2/images/",
                    sequenceMode:  false,
                    showNavigator:  true,
                    tileSources:   [this.media_iiif_info],
                });
            },
        },
        components: {
            {% if GEO_JSON %}
            'common_map': vc_common_map,
            {%endif%}

            'human-remains-results-alert': vc_human_remains_results_alert,
            'human-remains-image': vc_human_remains_image,
            
            {% if man_obj.item_type == 'predicates' %}
            'vc-predicates': vc_predicates,
            {%endif%}
            {% if man_obj.item_type == 'types' %}
            'types-examples': vc_types_examples,
            {%endif%}
            {% if man_obj.item_type == 'projects' %}
            'vc-projects': vc_projects,
            {%endif%}

        },
      },
    ).$mount('#app');
    
</script>


<script type="application/ld+json">
    {{ SCHEMA_ORG_JSON_LD|safe }}
</script>
{% endblock %}2