{% block search_tabs %}

<template id="all-search-tabs-temp">
  <div>
    <ul class="nav nav-tabs" id="search-tabs-nav" role="tablist">
      <li class="nav-item" role="presentation">
        <a 
          class="nav-link active" 
          id="tab-map-time-ranges" 
          data-toggle="tab"
          :href="'#' + map_time_id" 
          aria-controls="map-time-ranges" 
          aria-selected="true">Map and Time Ranges</a>
      </li>

      <li 
        class="nav-item"
        role="presentation" 
        v-if="facets_numeric_groups_opts">
        <a 
          class="nav-link" 
          id="tab-numeric-fields" 
          data-toggle="tab"
          :href="'#' + numeric_fields_id" 
          aria-controls="numeric-fields" 
          aria-selected="false">Numeric Fields</a>
      </li>

    </ul>
    <div class="tab-content" id="all-search-tabs">
      <div 
        class="tab-pane fade show active"
        :id="map_time_id" 
        role="tabpanel" 
        aria-labelledby="tab-map-time-range">

        <div class="card">
          <div class="card-header">
            <h5 v-if="result">
                <span class="text-left">Map</span>
                <span class="text-right">[[ result['totalResults'] ]] Records</span>
            </h5>
            <h5 v-else>
                <span class="text-left">Map</span>
                <span class="text-right">Loading Records...</span>
            </h5>
          </div>
          <div class="card-body">
            <div id="app_media" v-if="result">
              <common_map
                :map_key="0"
                :map_class="'map_preview'"
                :min_height="800"
                :ref_suffix="'search-map'"
                v-bind:geo_json="result"></common_map>
            </div>
            <div class="jumbotron jumbotron-fluid" v-else>
                <div class="container-fluid text-muted text-center">
                  <h1 class="display-4">Getting map data...</h1>
                  <b-spinner class="m-5" label="Busy"></b-spinner>
                </div>
            </div>
          </div>
        </div>


        <div v-if="chrono_facets">
          <chronotiles
              :key="'chrono-tiles-component-' + chrono_tiles_component_key_index"
              v-bind:result_id="result.id"
              v-bind:chrono_facets="chrono_facets"></chronotiles>
        </div>

      </div>

      <div 
        class="tab-pane fade" 
        :id="numeric_fields_id"
        role="tabpanel"
        aria-labelledby="tab-numeric-fields"
        v-if="facets_numeric_groups_opts"
        >
        
        <all-numeric-facets
          v-bind:facets_numeric_groups_opts="facets_numeric_groups_opts"
          v-bind:facets_int_groups_opts="facets_int_groups_opts"
          v-bind:facets_double_groups_opts="facets_double_groups_opts"
          v-bind:facets_date_groups_opts="facets_date_groups_opts"
        ></all-numeric-facets>

      </div>

    </div>

  </div>
</template>


<script type="text/javascript">

var vc_all_search_tabs = Vue.component(
    'all-search-tabs',
    {
      delimiters: ['[[', ']]'],
      props: [
        'result',
        'chrono_facets',
        'chrono_tiles_component_key_index',
      ],
      template: '#all-search-tabs-temp',
      data: {
        message: 'Open Context Search Result',
        result: null,
        map: null,
        tile_layer: null,
        emit_update_fetch_done: false,
        chrono_tiles_component_key_index: 0,
      },
      computed: {
        map_time_id: function () {
          let frag_obj = get_search_current_frag_obj();
          frag_obj.tab = 'map-time-ranges';
          // return encode_frag_obj(frag_obj);
          return frag_obj.tab;
        },
        numeric_fields_id: function () {
          let frag_obj = get_search_current_frag_obj();
          frag_obj.tab = 'numeric-fields';
          // return encode_frag_obj(frag_obj);
          return frag_obj.tab;
        },
        facets_numeric_groups_opts: function() {
            // Group facet fields and options
            // returned from the API
            if(!this.result){
              return null;
            }
            // return null;
            return prepare_facets_dtypes_groups_opts_by_data_types(
              this.result,
              ['int', 'double', 'date']
            );
        },
        facets_int_groups_opts: function() {
            // Group facet fields and options
            // returned from the API
            if(!this.result){
              return null;
            }
            return prepare_facets_dtypes_groups_opts_by_data_types(
              this.result,
              ['int',]
            );
        },
        facets_double_groups_opts: function() {
            // Group facet fields and options
            // returned from the API
            if(!this.result){
              return null;
            }
            return prepare_facets_dtypes_groups_opts_by_data_types(
              this.result,
              ['double',]
            );
        },
        facets_date_groups_opts: function() {
            // Group facet fields and options
            // returned from the API
            if(!this.result){
              return null;
            }
            return prepare_facets_dtypes_groups_opts_by_data_types(
              this.result,
              ['date',]
            );
        },
      },
      components: {
        'common_map': vc_common_map,
        'chronotiles': vc_chronotiles,
        'all-numeric-facets': vc_all_numeric_facets,
      }
    }
);

</script>

{% endblock %}