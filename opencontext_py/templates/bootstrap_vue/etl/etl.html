<!DOCTYPE html>

<html lang="en">
    {% include '../../bootstrap_vue/etl/head.html' %}
    <body>

        <!-- Include the more general components first-->
        {% include '../../bootstrap_vue/editorial/tree.html' %}
        {% include '../../bootstrap_vue/editorial/lookup.html' %}

        {% include '../../bootstrap_vue/etl/ds_fields_cells.html' %}
        {% include '../../bootstrap_vue/etl/ds_fields_general.html' %}
        {% include '../../bootstrap_vue/etl/ds_fields_specific.html' %}

        <div id="main">
            <b-container fluid id="app">
                <b-row>
                    <b-col>
                        <h1>[[ message ]]</h1>
                    </b-col>
                    <b-col>
                        <b-card>
                            Data source: [[ source_id ]]
                        </b-card>
                    </b-col>
                </b-row>
                <div>
                    <b-nav pills>
                      <b-nav-item :to="{ name: 'home'}" >Home</b-nav-item>
                      <b-nav-item :to="{ name: 'ds-fields-general'}">Fields</b-nav-item>
                      <b-nav-item :to="{ name: 'ds-fields-specific'}">Fields Specifics</b-nav-item>
                      <b-nav-item :to="{ name: 'link-rels'}">Link Relations</b-nav-item>
                      <b-nav-item :to="{ name: 'describe-rels'}">Descriptive Relations</b-nav-item>
                      <b-nav-item :to="{ name: 'finalize'}">Finalize</b-nav-item>
                    </b-nav>
                </div>
                
                <router-view></router-view>
                
            </b-container>
        </div>



        <script type="text/javascript">

            // A hacky solution for scaling the height of tables
            var body = document.body;
            var html = document.documentElement;
            var page_height = Math.max(
                body.scrollHeight, body.offsetHeight, 
                html.clientHeight, html.scrollHeight, html.offsetHeight
            );
            var table_height = `${(Math.ceil((page_height * 0.75) / 10) * 10)}px`;

            // Populated by Django.
            const csrftoken = Vue.$cookies.get('csrftoken');
            const base_url = '{{ base_url|safe }}';
            const source_id = '{{ ds_source.source_id }}';
            const source_uuid = '{{ ds_source.uuid }}';

            const routes = [
                {
                    path: '/etl-importer/prepare/' + source_uuid,
                    name: 'home',
                    component: vc_ds_fields_general,
                    props: {source_uuid: source_uuid, ds_fields_table_height: table_height},
                },
                {
                    path: '/etl-importer/prepare/' + source_uuid + '#ds-fields-general',
                    name: 'ds-fields-general',
                    component: vc_ds_fields_general,
                    props: {source_uuid: source_uuid, ds_fields_table_height: table_height},
                },
                {
                    path: '/etl-importer/prepare/' + source_uuid + '#ds-fields-specific',
                    name: 'ds-fields-specific',
                    component: vc_ds_fields_specific,
                    props: {source_uuid: source_uuid, ds_fields_table_height: table_height},
                },
                {
                    path: '/etl-importer/prepare/' + source_uuid + '#link-rels',
                    name: 'link-rels',
                    component: vc_ds_fields_general,
                    props: {source_uuid: source_uuid, ds_fields_table_height: '250px'},
                },
                {
                    path: '/etl-importer/prepare/' + source_uuid + '#describe-rels',
                    name: 'describe-rels',
                    component: vc_ds_fields_general,
                    props: {source_uuid: source_uuid, ds_fields_table_height: '50px'},
                },
                {
                    path: '/etl-importer/prepare/' + source_uuid + '#finalize',
                    name: 'finalize',
                    component: vc_ds_fields_general,
                    props: {source_uuid: source_uuid, ds_fields_table_height: '150px'},
                }
            ];

            const router = new VueRouter({
                mode: 'history',
                routes: routes,
            });

            var vm = new Vue(
                {
                    router: router,
                    delimiters: ['[[', ']]'],
                    ref: 'etl_app',
                    el: '#app',
                    data: {
                        message: 'Open Context ETL',
                        source_id: source_id,
                        source_uuid: source_uuid,
                        page_height: page_height,
                        ds_fields_table_height: `${(Math.ceil((page_height * 0.75) / 10) * 10)}px`,
                    },
                    components: {
                        'ds-fields-general': vc_ds_fields_general,
                        'ds-fields-specific': vc_ds_fields_specific,
                    },
                },
            ).$mount('#app');

        </script>
    </body>
</html>
